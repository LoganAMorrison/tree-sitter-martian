================================================================================
Map Call
================================================================================


stage SQUARE(
    in  float value,
    out float square,
    src comp  "square",
)

stage SUM(
    in  float[] values,
    out float   sum,
    src comp    "sum",
)

pipeline SUM_SQUARES(
    in  float[] values,
    out float   sum,
)
{
    map call SQUARE(
        value = split self.values,
    )

    call SUM(
        values = SQUARE.square,
    )

    return (
        value = SUM.sum,
    )
}

--------------------------------------------------------------------------------

(source_file
  (stage_declaration
    name: (identifier)
    (stage_body
      (parameter_list
        (in_param
          type: (parameter_type
            (primitive_type))
          name: (identifier))
        (out_param
          type: (parameter_type
            (primitive_type))
          name: (identifier)))
      (src_stm
        type: (src_lang)
        source_path: (string))))
  (stage_declaration
    name: (identifier)
    (stage_body
      (parameter_list
        (in_param
          type: (parameter_type
            (array_type
              (parameter_type
                (primitive_type))))
          name: (identifier))
        (out_param
          type: (parameter_type
            (primitive_type))
          name: (identifier)))
      (src_stm
        type: (src_lang)
        source_path: (string))))
  (pipeline_declaration
    name: (identifier)
    parameters: (parameter_list
      (in_param
        type: (parameter_type
          (array_type
            (parameter_type
              (primitive_type))))
        name: (identifier))
      (out_param
        type: (parameter_type
          (primitive_type))
        name: (identifier)))
    (call_stm
      name: (identifier)
      (binding_list
        (binding
          target: (binding_target
            (identifier))
          value: (expression
            (ref_exp
              (ref_list
                (identifier)))))))
    (call_stm
      name: (identifier)
      (binding_list
        (binding
          target: (binding_target
            (identifier))
          value: (expression
            (ref_exp
              (ref_list
                (id_list
                  (identifier)
                  (identifier))))))))
    (return_stm
      (binding_list
        (binding
          target: (binding_target
            (identifier))
          value: (expression
            (ref_exp
              (ref_list
                (id_list
                  (identifier)
                  (identifier))))))))))
